<?php

class Booster {

    /**
     * @var array
     */
    private $cards;
    private $edition;

    public function __construct($edition)
    {
        $this->edition = $edition;
    }

    public function generateBooster()
    {
        $this->cards   = array();
        $this->cards[] = $this->getRandomCard($this->edition, "rare");
        for ($i = 0; $i < 3; $i++) {
            //doppelte verhindern
            $newcard = $this->getRandomCard($this->edition, "uncommon");
            if (!in_array($newcard, $this->cards)) {
                $this->cards[] = $newcard;
            } else {
                $i--;
            }
        }
        for ($i = 0; $i < 11; $i++) {
            //doppelte verhindern
            $newcard = $this->getRandomCard($this->edition, "common");
            if (!in_array($newcard, $this->cards)) {
                $this->cards[] = $newcard;
            } else {
                $i--;
            }
        }
    }

    public function printBooster()
    {
        $i = 0;
        foreach ($this->cards as $cardlink) {
            $i++;
            echo '<img src="' . $cardlink . '"alt="Proxy" style="margin: 0pt 1px 1px 0pt;" height="319" width="222">';
        }
    }

    public function getRandomCard($editionshort, $rarity)
    {
        $table    = "cardlinktable";
        $sql      = "SELECT picturelink FROM $table WHERE edition= ? AND rarity = ? ORDER BY RAND() LIMIT 1";
        $result   = $this->ps($sql, array($editionshort, $rarity));
        $cardlink = $result->fetch();
        if ($cardlink === false) {
            throw new \Exception(sprintf('Unable to get card with rarity %s for edition %s', $rarity, $editionshort));
        }
        return $cardlink['picturelink'];
    }

    //Konfigurationen
    private function ps($sql, $param_array = array())
    {
        include ("dbconnect.php");
        $stmt = $dbc->prepare($sql);
        if ($stmt->execute($param_array)) {
            return $stmt;
        } else {
            return $stmt;
        }
    }

}

if (isset($_GET['edition'])) {
    $booster = new Booster($_GET['edition']);
    $booster->generateBooster();
    $booster->printBooster();

    //echo count($edition[0])+ count($edition[1])+ count($edition[2]);
    // TODO extra select für sprache wäre nett
} else {
    ?> <form action method=GET>
        <select name="edition">
            <option value=""></option>
            <optgroup label="Amonkhet (Deutsch)"><option value="akh/de">Amonkhet</option></optgroup><optgroup label="Kaladesh (Deutsch)"><option value="aer/de">Äther-Rebellion</option><option value="kld/de">Kaladesh</option></optgroup><optgroup label="Shadows over Innistrad (Deutsch)"><option value="emn/de">Düstermond</option><option value="soi/de">Schatten über Innistrad</option></optgroup><optgroup label="Battle for Zendikar (Deutsch)"><option value="ogw/de">Eid der Wächter</option><option value="bfz/de">Kampf um Zendikar</option></optgroup><optgroup label="Khans of Tarkir (Deutsch)"><option value="dtk/de">Drachen von Tarkir</option><option value="frf/de">Schmiede des Schicksals</option><option value="ktk/de">Khane von Tarkir</option></optgroup><optgroup label="Theros (Deutsch)"><option value="jou/de">Reise nach Nyx</option><option value="bng/de">Kinder der Götter</option><option value="ths/de">Theros</option></optgroup><optgroup label="Return to Ravnica (Deutsch)"><option value="dgm/de">Labyrinth des Drachen</option><option value="gtc/de">Gildensturm</option><option value="rtr/de">Rückkehr nach Ravnica</option></optgroup><optgroup label="Innistrad Cycle (Deutsch)"><option value="avr/de">Avacyns Rückkehr</option><option value="dka/de">Dunkles Erwachen</option><option value="isd/de">Innistrad</option></optgroup><optgroup label="Scars of Mirrodin (Deutsch)"><option value="nph/de">Das neue Phyrexia</option><option value="mbs/de">Belagertes Mirrodin</option><option value="som/de">Die Narben von Mirrodin</option></optgroup><optgroup label="Zendikar Cycle (Deutsch)"><option value="roe/de">Aufstieg der Eldrazi</option><option value="wwk/de">Weltenerwachen</option><option value="zen/de">Zendikar</option></optgroup><optgroup label="Shards of Alara (Deutsch)"><option value="arb/de">Alara Reborn</option><option value="cfx/de">Conflux</option><option value="ala/de">Fragmente von Alara</option></optgroup><optgroup label="Shadowmoor Cycle (Deutsch)"><option value="eve/de">Abendkühle</option><option value="shm/de">Schattenmoor</option></optgroup><optgroup label="Lorwyn Cycle (Deutsch)"><option value="mt/de">Morgenluft</option><option value="lw/de">Lorwyn</option></optgroup><optgroup label="Time Spiral Cycle (Deutsch)"><option value="fut/de">Blick in die Zukunft</option><option value="pc/de">Weltenchaos</option><option value="ts/de">Zeitspirale</option><option value="tsts/de">Zeitspirale Timeshifted</option></optgroup><optgroup label="Ice Age Cycle (Deutsch)"><option value="cs/de">Kälteeinbruch</option><option value="ai/de">Allianzen</option><option value="ia/de">Eiszeit</option></optgroup><optgroup label="Ravnica Cycle (Deutsch)"><option value="di/de">Zwietracht</option><option value="gp/de">Gildenbund</option><option value="rav/de">Ravnica: Stadt der Gilden</option></optgroup><optgroup label="Kamigawa Cycle (Deutsch)"><option value="sok/de">Retter von Kamigawa</option><option value="bok/de">Verräter von Kamigawa</option><option value="chk/de">Meister von Kamigawa</option></optgroup><optgroup label="Mirrodin Cycle (Deutsch)"><option value="5dn/de">Fünfte Morgenröte</option><option value="ds/de">Nachtstahl</option><option value="mi/de">Mirrodin</option></optgroup><optgroup label="Onslaught Cycle (Deutsch)"><option value="sc/de">Plagen</option><option value="le/de">Legionen</option><option value="on/de">Aufmarsch</option></optgroup><optgroup label="Odyssey Cycle (Deutsch)"><option value="ju/de">Abrechnung</option><option value="tr/de">Qualen</option><option value="od/de">Odyssee</option></optgroup><optgroup label="Invasion Cycle (Deutsch)"><option value="ap/de">Apokalypse</option><option value="ps/de">Weltenwechsel</option><option value="in/de">Invasion</option></optgroup><optgroup label="Masquerade Cycle (Deutsch)"><option value="pr/de">Prophezeihung</option><option value="ne/de">Nemesis</option><option value="mm/de">Merkadische Masken</option></optgroup><optgroup label="Artifacts Cycle (Deutsch)"><option value="ud/de">Urzas Schicksal</option><option value="ul/de">Urzas Vermächtnis</option><option value="us/de">Urzas Saga</option></optgroup><optgroup label="Rath Cycle (Deutsch)"><option value="ex/de">Exodus</option><option value="sh/de">Felsenburg</option><option value="tp/de">Sturmwind</option></optgroup><optgroup label="Mirage Cycle (Deutsch)"><option value="wl/de">Wetterlicht</option><option value="vi/de">Visionen</option><option value="mr/de">Trugbilder</option></optgroup><optgroup label="Early Sets (Deutsch)"><option value="hl/de">Heimatländer</option></optgroup><optgroup label="Core Set Editions (Deutsch)"><option value="ori/de">Magic Ursprünge</option><option value="m15/de">Magic 2015</option><option value="m14/de">Hauptset Magic 2014</option><option value="m13/de">Magic 2013</option><option value="m12/de">Magic 2012</option><option value="m11/de">Magic 2011</option><option value="m10/de">Magic 2010</option><option value="10e/de">Zehnte Edition</option><option value="9e/de">Haupt-Set - Neunte Edition</option><option value="8e/de">Haupt-Set - Achte Edition</option><option value="7e/de">Siebte Edition</option><option value="6e/de">Classic Sechste Edition</option><option value="5e/de">Fünfte Edition</option><option value="4e/de">Vierte Edition</option><option value="rv/de">Unlimitierte Auflage</option><option value="rvb/de">Limitierte Auflage</option></optgroup><optgroup label="Reprint Sets (Deutsch)"><option value="re/de">Renaissance</option></optgroup><optgroup label="“Command Zone” Series (Deutsch)"><option value="c16/de">Commander (Edition 2016)</option><option value="c15/de">Commander 2015</option><option value="c14/de">Commander 2014 Edition</option><option value="c13/de">Commander 2013 Edition</option><option value="pc2/de">Planechase 2012 Edition</option><option value="cmd/de">Commander</option></optgroup><optgroup label="Duel Decks (Deutsch)"><option value="ddh/de">Duel Decks: Ajani vs. Nicol Bolas</option><option value="ddg/de">Duel Decks: Knights vs. Dragons</option><option value="ddf/de">Duel Decks: Elspeth vs. Tezzeret</option></optgroup><optgroup label="Theme Decks (Deutsch)"><option value="cstd/de">Kälteeinbruch-Themendecks</option></optgroup><optgroup label="Independent Box Sets (Deutsch)"><option value="9eb/de">Neunte Edition Box Set</option><option value="8eb/de">Achte Edition Box Set</option></optgroup><optgroup label="Beginner Sets (Deutsch)"><option value="w16/de">Welcome Deck 2016</option><option value="st2k/de">Starter 2000</option><option value="po2/de">Portal Zweites Zeitalter</option><option value="po/de">Portal</option><option value="itp/de">Introductory Two-Player Set</option></optgroup><optgroup label="Event Incentives (Deutsch)"><option value="ugin/de">Ugin's Fate</option></optgroup><optgroup label="Tournament Rewards (Deutsch)"><option value="ptc/de">Prerelease Events</option><option value="grc/de">WPN/Gateway</option></optgroup><optgroup label="Media Inserts (Deutsch)"><option value="mbp/de">Media Inserts</option><option value="dembp/de">Media Inserts</option></optgroup><optgroup label="Amonkhet (English)"><option value="akh/en">Amonkhet</option></optgroup><optgroup label="Kaladesh (English)"><option value="aer/en">Aether Revolt</option><option value="kld/en">Kaladesh</option></optgroup><optgroup label="Shadows over Innistrad (English)"><option value="emn/en">Eldritch Moon</option><option value="soi/en">Shadows over Innistrad</option></optgroup><optgroup label="Battle for Zendikar (English)"><option value="ogw/en">Oath of the Gatewatch</option><option value="bfz/en">Battle for Zendikar</option></optgroup><optgroup label="Khans of Tarkir (English)"><option value="dtk/en">Dragons of Tarkir</option><option value="frf/en">Fate Reforged</option><option value="ktk/en">Khans of Tarkir</option></optgroup><optgroup label="Theros (English)"><option value="jou/en">Journey into Nyx</option><option value="bng/en">Born of the Gods</option><option value="ths/en">Theros</option></optgroup><optgroup label="Return to Ravnica (English)"><option value="dgm/en">Dragon's Maze</option><option value="gtc/en">Gatecrash</option><option value="rtr/en">Return to Ravnica</option></optgroup><optgroup label="Innistrad Cycle (English)"><option value="avr/en">Avacyn Restored</option><option value="dka/en">Dark Ascension</option><option value="isd/en">Innistrad</option></optgroup><optgroup label="Scars of Mirrodin (English)"><option value="nph/en">New Phyrexia</option><option value="mbs/en">Mirrodin Besieged</option><option value="som/en">Scars of Mirrodin</option></optgroup><optgroup label="Zendikar Cycle (English)"><option value="roe/en">Rise of the Eldrazi</option><option value="wwk/en">Worldwake</option><option value="zen/en">Zendikar</option></optgroup><optgroup label="Shards of Alara (English)"><option value="arb/en">Alara Reborn</option><option value="cfx/en">Conflux</option><option value="ala/en">Shards of Alara</option></optgroup><optgroup label="Shadowmoor Cycle (English)"><option value="eve/en">Eventide</option><option value="shm/en">Shadowmoor</option></optgroup><optgroup label="Lorwyn Cycle (English)"><option value="mt/en">Morningtide</option><option value="lw/en">Lorwyn</option></optgroup><optgroup label="Time Spiral Cycle (English)"><option value="fut/en">Future Sight</option><option value="pc/en">Planar Chaos</option><option value="ts/en">Time Spiral</option><option value="tsts/en">Time Spiral "Timeshifted"</option></optgroup><optgroup label="Ice Age Cycle (English)"><option value="cs/en">Coldsnap</option><option value="ai/en">Alliances</option><option value="ia/en">Ice Age</option></optgroup><optgroup label="Ravnica Cycle (English)"><option value="di/en">Dissension</option><option value="gp/en">Guildpact</option><option value="rav/en">Ravnica: City of Guilds</option></optgroup><optgroup label="Kamigawa Cycle (English)"><option value="sok/en">Saviors of Kamigawa</option><option value="bok/en">Betrayers of Kamigawa</option><option value="chk/en">Champions of Kamigawa</option></optgroup><optgroup label="Mirrodin Cycle (English)"><option value="5dn/en">Fifth Dawn</option><option value="ds/en">Darksteel</option><option value="mi/en">Mirrodin</option></optgroup><optgroup label="Onslaught Cycle (English)"><option value="sc/en">Scourge</option><option value="le/en">Legions</option><option value="on/en">Onslaught</option></optgroup><optgroup label="Odyssey Cycle (English)"><option value="ju/en">Judgment</option><option value="tr/en">Torment</option><option value="od/en">Odyssey</option></optgroup><optgroup label="Invasion Cycle (English)"><option value="ap/en">Apocalypse</option><option value="ps/en">Planeshift</option><option value="in/en">Invasion</option></optgroup><optgroup label="Masquerade Cycle (English)"><option value="pr/en">Prophecy</option><option value="ne/en">Nemesis</option><option value="mm/en">Mercadian Masques</option></optgroup><optgroup label="Artifacts Cycle (English)"><option value="ud/en">Urza's Destiny</option><option value="ul/en">Urza's Legacy</option><option value="us/en">Urza's Saga</option></optgroup><optgroup label="Rath Cycle (English)"><option value="ex/en">Exodus</option><option value="sh/en">Stronghold</option><option value="tp/en">Tempest</option></optgroup><optgroup label="Mirage Cycle (English)"><option value="wl/en">Weatherlight</option><option value="vi/en">Visions</option><option value="mr/en">Mirage</option></optgroup><optgroup label="Early Sets (English)"><option value="hl/en">Homelands</option><option value="fe/en">Fallen Empires</option><option value="dk/en">The Dark</option><option value="lg/en">Legends</option><option value="aq/en">Antiquities</option><option value="an/en">Arabian Nights</option></optgroup><optgroup label="Core Set Editions (English)"><option value="ori/en">Magic Origins</option><option value="m15/en">Magic 2015</option><option value="m14/en">Magic 2014 Core Set</option><option value="m13/en">Magic 2013</option><option value="m12/en">Magic 2012</option><option value="m11/en">Magic 2011</option><option value="m10/en">Magic 2010</option><option value="10e/en">Tenth Edition</option><option value="9e/en">Ninth Edition</option><option value="8e/en">Eighth Edition</option><option value="7e/en">Seventh Edition</option><option value="6e/en">Classic Sixth Edition</option><option value="5e/en">Fifth Edition</option><option value="4e/en">Fourth Edition</option><option value="rv/en">Revised Edition</option><option value="un/en">Unlimited Edition</option><option value="be/en">Limited Edition Beta</option><option value="al/en">Limited Edition Alpha</option></optgroup><optgroup label="Magic Online (English)"><option value="vma/en">Vintage Masters</option><option value="me4/en">MTGO Masters Edition IV</option><option value="me3/en">MTGO Masters Edition III</option><option value="me2/en">MTGO Masters Edition II</option><option value="med/en">MTGO Masters Edition</option></optgroup><optgroup label="Masterpiece Series (English)"><option value="mpskld/en">Kaladesh Inventions</option><option value="exp/en">Zendikar Expeditions</option></optgroup><optgroup label="“Conspiracy” Series (English)"><option value="cn2/en">Conspiracy: Take the Crown</option><option value="cns/en">Conspiracy</option></optgroup><optgroup label="Premium Deck Series (English)"><option value="pd3/en">Premium Deck Series: Graveborn</option><option value="pd2/en">Premium Deck Series: Fire and Lightning</option><option value="pds/en">Premium Deck Series: Slivers</option></optgroup><optgroup label="Reprint Sets (English)"><option value="mm3/en">Modern Masters 2017 Edition</option><option value="ema/en">Eternal Masters</option><option value="mm2/en">Modern Masters 2015 Edition</option><option value="tpr/en">Tempest Remastered</option><option value="md1/en">Modern Event Deck</option><option value="mma/en">Modern Masters</option><option value="dpa/en">Duels of the Planeswalkers</option><option value="ch/en">Chronicles</option></optgroup><optgroup label="“Command Zone” Series (English)"><option value="c16/en">Commander 2016</option><option value="pca/en">Planechase Anthology</option><option value="c15/en">Commander 2015</option><option value="c14/en">Commander 2014 Edition</option><option value="c13/en">Commander 2013 Edition</option><option value="cma/en">Commander's Arsenal</option><option value="pc2/en">Planechase 2012 Edition</option><option value="cmd/en">Commander</option><option value="arc/en">Archenemy</option><option value="pch/en">Planechase</option></optgroup><optgroup label="From The Vault (English)"><option value="v16/en">From the Vault: Lore</option><option value="v15/en">From the Vault: Angels</option><option value="v14/en">From the Vault: Annihilation</option><option value="v13/en">From the Vault: Twenty</option><option value="v12/en">From the Vault: Realms</option><option value="fvl/en">From the Vault: Legends</option><option value="fvr/en">From the Vault: Relics</option><option value="fve/en">From the Vault: Exiled</option><option value="fvd/en">From the Vault: Dragons</option></optgroup><optgroup label="Duel Decks (English)"><option value="dds/en">Duel Decks: Mind vs. Might</option><option value="ddr/en">Duel Decks: Nissa vs. Ob Nixilis</option><option value="ddq/en">Duel Decks: Blessed vs. Cursed</option><option value="ddp/en">Duel Decks: Zendikar vs. Eldrazi</option><option value="ddadvd/en">Duel Decks Anthology: Divine vs. Demonic</option><option value="ddaevg/en">Duel Decks Anthology: Elves vs. Goblins</option><option value="ddagvl/en">Duel Decks Anthology: Garruk vs. Liliana</option><option value="ddajvc/en">Duel Decks Anthology: Jace vs. Chandra</option><option value="ddo/en">Duel Decks: Kiora vs. Elspeth</option><option value="ddn/en">Duel Decks: Speed vs. Cunning</option><option value="ddm/en">Duel Decks: Jace vs. Vraska</option><option value="ddl/en">Duel Decks: Heroes vs. Monsters</option><option value="ddk/en">Duel Decks: Sorin vs. Tibalt</option><option value="ddj/en">Duel Decks: Izzet vs. Golgari</option><option value="ddi/en">Duel Decks: Venser vs. Koth</option><option value="ddh/en">Duel Decks: Ajani vs. Nicol Bolas</option><option value="ddg/en">Duel Decks: Knights vs. Dragons</option><option value="ddf/en">Duel Decks: Elspeth vs. Tezzeret</option><option value="pvc/en">Duel Decks: Phyrexia vs. The Coalition</option><option value="gvl/en">Duel Decks: Garruk vs. Liliana</option><option value="dvd/en">Duel Decks: Divine vs. Demonic</option><option value="jvc/en">Duel Decks: Jace vs. Chandra</option><option value="evg/en">Duel Decks: Elves vs. Goblins</option></optgroup><optgroup label="Theme Decks (English)"><option value="cstd/en">Coldsnap Theme Decks</option></optgroup><optgroup label="Independent Box Sets (English)"><option value="9eb/en">Ninth Edition Box Set</option><option value="8eb/en">Eighth Edition Box Set</option><option value="dm/en">Deckmasters</option><option value="bd/en">Beatdown Box Set</option><option value="br/en">Battle Royale Box Set</option><option value="at/en">Anthologies</option><option value="mgbc/en">Multiverse Gift Box Cards</option></optgroup><optgroup label="Un-Serious Sets (English)"><option value="uh/en">Unhinged</option><option value="ug/en">Unglued</option></optgroup><optgroup label="Alternate Art (English)"><option value="uhaa/en">Unhinged Alternate Foils</option></optgroup><optgroup label="Beginner Sets (English)"><option value="w16/en">Welcome Deck 2016</option><option value="st2k/en">Starter 2000</option><option value="st/en">Starter 1999</option><option value="p3k/en">Portal Three Kingdoms</option><option value="po2/en">Portal Second Age</option><option value="po/en">Portal</option><option value="itp/en">Introductory Two-Player Set</option></optgroup><optgroup label="Not Legal for Tournament Play (English)"><option value="ced/en">Collector's Edition</option><option value="cedi/en">International Collectors' Edition</option></optgroup><optgroup label="Event Incentives (English)"><option value="ugin/en">Ugin's Fate</option><option value="15ann/en">15th Anniversary</option><option value="gpx/en">Grand Prix</option><option value="pro/en">Pro Tour</option><option value="mgdc/en">Magic Game Day Cards</option><option value="wrl/en">Worlds</option><option value="wmcq/en">World Magic Cup Qualifiers</option><option value="drc/en">Dragon Con</option></optgroup><optgroup label="Tournament Rewards (English)"><option value="ptc/en">Prerelease Events</option><option value="rep/en">Release Events</option><option value="mlp/en">Magic: The Gathering Launch Parties</option><option value="sum/en">Summer of Magic</option><option value="grc/en">WPN/Gateway</option><option value="cp/en">Champs</option><option value="thgt/en">Two-Headed Giant Tournament</option><option value="arena/en">Arena League</option><option value="fnmp/en">Friday Night Magic</option><option value="mprp/en">Magic Player Rewards</option><option value="sus/en">Super Series</option></optgroup><optgroup label="Gifts (English)"><option value="hho/en">Happy Holidays</option><option value="jr/en">Judge Gift Program</option><option value="pot/en">Portal Demogame</option></optgroup><optgroup label="Redemption Rewards (English)"><option value="euro/en">European Land Program</option><option value="guru/en">Guru</option><option value="apac/en">Asia Pacific Land Program</option><option value="wotc/en">WotC Online Store</option></optgroup><optgroup label="Celebration Cards (English)"><option value="uqc/en">Celebration Cards</option></optgroup><optgroup label="Media Inserts (English)"><option value="clash/en">Clash Pack</option><option value="mbp/en">Media Inserts</option></optgroup><optgroup label="Membership Incentives (English)"><option value="dcilm/en">Legend Membership</option>
        </select>
        <input type=submit value='MACH MIR DAS BOOSTER!!!'>
    </form>
    <?php
}
?>